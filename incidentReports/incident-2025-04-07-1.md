# Incident: 2025-04-07 08-40

## Summary

On April 7, 2025, the pizza ordering system broke. Customers couldn't buy pizzas because our system couldn't talk to the pizza factory service. I found the problem by running tests and fixed it by using a special repair link.



## Detection

I found the problem around 8:40 AM on April 7 when our test script showed errors. The test showed error codes 401 and 500 when trying to buy pizzas:
Bought a pizza... 401
Bought a pizza... 500
Also, on Grafana I set up metrics that alert when profit is 0 and when pizza sales were failing.


## Impact

* What broke: Customers couldn't order pizzas
* Who was affected: All customers trying to buy pizzas
* Business impact:  couldn't sell any pizzas during this time


## Timeline

- _08:40_ - First errors appear in our logs
- _08:43_ - Noticed failed pizza orders in our tests
- _09:40_ - Confirmed orders were working again


## Response

-I responded to the incident at approximately 8:43 AM on April 8, 2025, just a few minutes after errors began appearing in our logs. As soon as I noticed the failed pizza orders in our testing script, I immediately began investigating the issue.
-First, I checked the Grafana dashboard, which confirmed that our profit metrics had dropped to zero and pizza sales were failing. The alert I had previously set up for "profit = 0" had triggered, which helped validate that this was a real issue affecting our business operations.
-I checked all other metrics I had created and they showed that pizza purchases were failing.

## Root cause

- The problem was caused by a planned test called "chaos monkey" that broke the pizza factory service on purpose. The system couldn't order pizzas because the factory service was programmed to reject all requests.
- We found this by using a step-by-step troubleshooting approach:

- I pinged the factory service domain to check if it was reachable: pizza-factory.cs329.click
->The domain responded, confirming network connectivity was not the issue.
- I checked if the factory service was responding to basic requests: curl https://pizza-factory.cs329.click/api/health
The service responded with {"message":"unknown endpoint"}, showing the service was running but the endpoint didn't exist.
- We then tested the exact endpoint our application uses:
curl -X POST https://pizza-factory.cs329.click/api/order -H 'Content-Type: application/json' -H 'Authorization: Bearer myfactoryAPIKey' -d '{"test": true}'

This revealed the key error message:
{"message":"chaos monkey","reportUrl":"https://cs329.cs.byu.edu/api/report?apiKey=myfactoryAPIKey&fixCode=88563bf6b602499e9801c2ef8e19dcb5"}


## Resolution

I fixed the problem by:
Using the repair link that was in the error message:
curl "https://cs329.cs.byu.edu/api/report?apiKey=myFactoryApiKey&fixCode=88563bf6b602499e9801c2ef8e19dcb5"

The system told us it was fixed:
{"msg":"Chaos resolved"}


## Prevention

- Since this was for an assignment, and I was able to check the terminal constantly during the test hours, I caught the problem right when the chaos started. We were told that we didn't have to change our code and the hint was "URL," which helped to narrow down what could be wrong. But in real life, it wouldn't be this simple.
- I could add more specific alerts for certain log patterns by thinking about what could go wrong, so that we can get alerts without having to watch the terminal. I could also create a troubleshooting guide with steps to follow when specific problems happen.


## Action items

- Improve Monitoring System
- Create Factory Service Troubleshooting Guide
- Regular Testing Schedule
